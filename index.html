<!DOCTYPE html>
<html lang="th">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>‡πÅ‡∏ö‡∏ö‡∏õ‡∏£‡∏∞‡πÄ‡∏°‡∏¥‡∏ô‡∏Å‡∏≤‡∏£‡πÅ‡∏û‡πâ‡∏¢‡∏≤ (Hospital Form)</title>
    <link rel="stylesheet" href="style.css">
    <link href="https://fonts.googleapis.com/css2?family=Sarabun:wght@300;400;500;600;700&display=swap" rel="stylesheet">
</head>
<body>

    <div class="container">
        
        <header class="header no-print">
            <h1>üíä ‡∏£‡∏∞‡∏ö‡∏ö‡∏õ‡∏£‡∏∞‡πÄ‡∏°‡∏¥‡∏ô‡∏Å‡∏≤‡∏£‡πÅ‡∏û‡πâ‡∏¢‡∏≤ (Drug Allergy Assessment)</h1>
            <p>Smart Search (FDA) + Diagnosis Type + Compact Print</p>
        </header>

        <div class="print-header-formal">
            <div class="logo-area">
                <div class="logo-box">üè• LOGO</div>
                <div class="hospital-name">
                    <h3>‡πÇ‡∏£‡∏á‡∏û‡∏¢‡∏≤‡∏ö‡∏≤‡∏•............................................</h3>
                    <p>‡πÅ‡∏ö‡∏ö‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡∏Å‡∏≤‡∏£‡∏õ‡∏£‡∏∞‡πÄ‡∏°‡∏¥‡∏ô‡∏Å‡∏≤‡∏£‡πÅ‡∏û‡πâ‡∏¢‡∏≤ (Drug Allergy Causality Assessment)</p>
                </div>
            </div>
            <div class="patient-info-box">
                <div class="info-row">
                    <span><strong>‡∏ä‡∏∑‡πà‡∏≠-‡∏™‡∏Å‡∏∏‡∏•:</strong> <span id="pNameDisplay"></span></span>
                    <span><strong>HN:</strong> <span id="pHNDisplay"></span></span>
                    <span><strong>‡∏≠‡∏≤‡∏¢‡∏∏:</strong> <span id="pAgeDisplay"></span> ‡∏õ‡∏µ</span>
                </div>
                <div class="info-row">
                    <span><strong>‡∏´‡∏≠‡∏ú‡∏π‡πâ‡∏õ‡πà‡∏ß‡∏¢:</strong> <span id="pWardDisplay"></span></span>
                    <span><strong>‡∏ß‡∏±‡∏ô‡∏ó‡∏µ‡πà‡∏õ‡∏£‡∏∞‡πÄ‡∏°‡∏¥‡∏ô:</strong> <span id="pDateDisplay"></span></span>
                </div>
            </div>
        </div>

        <form id="assessmentForm" autocomplete="off">
            
            <section class="card section-patient no-print-data">
                <h3>1. ‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏ú‡∏π‡πâ‡∏õ‡πà‡∏ß‡∏¢ (Patient Information)</h3>
                <div class="grid-2">
                    <div class="form-group">
                        <label>‡∏ä‡∏∑‡πà‡∏≠-‡∏ô‡∏≤‡∏°‡∏™‡∏Å‡∏∏‡∏•:</label>
                        <input type="text" id="patientName" oninput="syncData()">
                    </div>
                    <div class="form-group">
                        <label>HN:</label>
                        <input type="text" id="patientHN" oninput="syncData()">
                    </div>
                    <div class="form-group">
                        <label>‡∏≠‡∏≤‡∏¢‡∏∏ (‡∏õ‡∏µ):</label>
                        <input type="number" id="patientAge" oninput="syncData()">
                    </div>
                    <div class="form-group">
                        <label>‡∏´‡∏≠‡∏ú‡∏π‡πâ‡∏õ‡πà‡∏ß‡∏¢:</label>
                        <input type="text" id="patientWard" oninput="syncData()">
                    </div>
                </div>
            </section>

            <section class="card section-timeline">
                <h3>2. ‡πÑ‡∏ó‡∏°‡πå‡πÑ‡∏•‡∏ô‡πå‡∏Å‡∏≤‡∏£‡πÉ‡∏ä‡πâ‡∏¢‡∏≤‡πÅ‡∏•‡∏∞‡∏≠‡∏≤‡∏Å‡∏≤‡∏£ (Timeline)</h3>
                <p class="hint no-print" style="font-size:0.85rem; color:#666; margin-bottom:10px;">* ‡∏´‡∏≤‡∏Å‡πÄ‡∏•‡∏∑‡∏≠‡∏Å "‡∏¢‡∏≤" ‡∏™‡∏≤‡∏°‡∏≤‡∏£‡∏ñ‡∏û‡∏¥‡∏°‡∏û‡πå‡∏ä‡∏∑‡πà‡∏≠‡∏¢‡∏≤‡πÄ‡∏û‡∏∑‡πà‡∏≠‡∏Ñ‡πâ‡∏ô‡∏´‡∏≤‡∏≠‡∏±‡∏ï‡πÇ‡∏ô‡∏°‡∏±‡∏ï‡∏¥ (OpenFDA)</p>
                
                <div class="timeline-input-box no-print">
                    <div class="input-group-pair">
                        <label>‡πÄ‡∏£‡∏¥‡πà‡∏° (Start)</label>
                        <div style="display:flex; gap:5px;">
                            <input type="date" id="tStartDate">
                            <input type="time" id="tStartTime">
                        </div>
                    </div>
                    <div class="input-group-pair">
                        <label>‡∏´‡∏¢‡∏∏‡∏î (Stop)</label>
                        <div style="display:flex; gap:5px;">
                            <input type="date" id="tStopDate">
                            <input type="time" id="tStopTime">
                        </div>
                    </div>
                    
                    <div class="input-group" style="flex:0 0 120px;">
                        <label>‡∏õ‡∏£‡∏∞‡πÄ‡∏†‡∏ó</label>
                        <select id="tType" onchange="togglePlaceholder()">
                            <option value="drug">üíä ‡∏¢‡∏≤ (Drug)</option>
                            <option value="symptom">‚ö†Ô∏è ‡∏≠‡∏≤‡∏Å‡∏≤‡∏£ (Symptom)</option>
                        </select>
                    </div>
                    
                    <div class="input-group" style="flex:2; position:relative;">
                        <label>‡∏£‡∏≤‡∏¢‡∏•‡∏∞‡πÄ‡∏≠‡∏µ‡∏¢‡∏î (Search FDA)</label>
                        <input type="text" id="tDesc" placeholder="‡∏û‡∏¥‡∏°‡∏û‡πå‡∏ä‡∏∑‡πà‡∏≠‡∏¢‡∏≤ (‡∏†‡∏≤‡∏©‡∏≤‡∏≠‡∏±‡∏á‡∏Å‡∏§‡∏©)..." oninput="handleInputSearch()">
                        <ul id="drugSuggestions" class="suggestions-list"></ul>
                    </div>

                    <button type="button" class="btn-add" onclick="addTimelineItem()">+ ‡πÄ‡∏û‡∏¥‡πà‡∏°</button>
                </div>

                <div class="timeline-visual-container" id="visualTimeline">
                    <div class="timeline-line"></div> 
                    <div class="timeline-empty-state">‡∏¢‡∏±‡∏á‡πÑ‡∏°‡πà‡∏°‡∏µ‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•</div>
                </div>
            </section>

            <section class="card section-algo">
                <h3>3. ‡∏Å‡∏≤‡∏£‡∏õ‡∏£‡∏∞‡πÄ‡∏°‡∏¥‡∏ô‡∏Ñ‡∏ß‡∏≤‡∏°‡∏™‡∏±‡∏°‡∏û‡∏±‡∏ô‡∏ò‡πå (Causality Assessment)</h3>
                
                <div class="tabs no-print">
                    <button type="button" class="tab-btn active" onclick="openTab('naranjo')">Naranjo</button>
                    <button type="button" class="tab-btn" onclick="openTab('liverpool')">Liverpool</button>
                    <button type="button" class="tab-btn" onclick="openTab('thai')">Thai FDA</button>
                    <button type="button" class="tab-btn" onclick="openTab('scorten')">SCORTEN</button>
                </div>

                <div id="naranjo" class="algo-content" style="display:block;">
                    <h4>3.1 Naranjo Algorithm</h4>
                    <table class="assessment-table compact-table">
                        <thead>
                            <tr>
                                <th>‡∏Ñ‡∏≥‡∏ñ‡∏≤‡∏° (Question)</th>
                                <th width="35">‡πÉ‡∏ä‡πà</th><th width="35">‡πÑ‡∏°‡πà‡πÉ‡∏ä‡πà</th><th width="35">?</th>
                            </tr>
                        </thead>
                        <tbody id="naranjoList"></tbody>
                    </table>
                    <div class="result-box">
                        ‡∏Ñ‡∏∞‡πÅ‡∏ô‡∏ô: <strong id="naranjoScore">0</strong> &nbsp;|&nbsp; 
                        ‡∏ú‡∏•: <strong id="naranjoResult">Doubtful</strong>
                    </div>
                </div>

                <div id="liverpool" class="algo-content" style="display:none;">
                    <h4>3.2 Liverpool Algorithm</h4>
                    <table class="assessment-table compact-table">
                        <tbody id="liverpoolList"></tbody>
                    </table>
                    <div class="result-box">‡∏ú‡∏•: <strong id="liverpoolResult">Unlikely</strong></div>
                </div>

                <div id="thai" class="algo-content" style="display:none;">
                    <h4>3.3 Thai FDA Algorithm</h4>
                    <div class="thai-criteria-print" id="thaiList"></div>
                    <div class="result-box">‡∏ú‡∏•: <strong id="thaiResult">Unlikely</strong></div>
                </div>

                <div id="scorten" class="algo-content" style="display:none;">
                    <h4>3.4 SCORTEN (SJS/TEN)</h4>
                    <table class="assessment-table compact-table">
                        <thead><tr><th>Risk Factor</th><th width="40">Yes</th></tr></thead>
                        <tbody id="scortenBody">
                            <tr><td>Age > 40</td><td class="center"><input type="checkbox" class="sc-chk" onchange="calcScorten()"></td></tr>
                            <tr><td>Malignancy</td><td class="center"><input type="checkbox" class="sc-chk" onchange="calcScorten()"></td></tr>
                            <tr><td>HR > 120</td><td class="center"><input type="checkbox" class="sc-chk" onchange="calcScorten()"></td></tr>
                            <tr><td>BSA detached > 10%</td><td class="center"><input type="checkbox" class="sc-chk" onchange="calcScorten()"></td></tr>
                            <tr><td>BUN > 28 mg/dL</td><td class="center"><input type="checkbox" class="sc-chk" onchange="calcScorten()"></td></tr>
                            <tr><td>Glucose > 252 mg/dL</td><td class="center"><input type="checkbox" class="sc-chk" onchange="calcScorten()"></td></tr>
                            <tr><td>HCO3 < 20 mEq/L</td><td class="center"><input type="checkbox" class="sc-chk" onchange="calcScorten()"></td></tr>
                        </tbody>
                    </table>
                    <div class="result-box">Score: <strong id="scScore">0</strong> | Mortality: <strong id="scMortality">3.2%</strong></div>
                </div>
            </section>

            <section class="card section-clinical">
                <h3>4. ‡∏≠‡∏≤‡∏Å‡∏≤‡∏£‡πÅ‡∏•‡∏∞‡∏Å‡∏≤‡∏£‡∏ß‡∏¥‡∏ô‡∏¥‡∏à‡∏â‡∏±‡∏¢ (Clinical & Diagnosis)</h3>
                
                <div class="grid-2">
                    <div class="form-group">
                        <label>‡∏Å‡∏≤‡∏£‡∏ß‡∏¥‡∏ô‡∏¥‡∏à‡∏â‡∏±‡∏¢ (Diagnosis Type): <span style="color:red">*</span></label>
                        <select id="diagnosisType" onchange="syncData()">
                            <option value="">-- ‡∏£‡∏∞‡∏ö‡∏∏‡∏õ‡∏£‡∏∞‡πÄ‡∏†‡∏ó --</option>
                            <option value="Maculopapular rash">Maculopapular rash (MPE)</option>
                            <option value="Urticaria">Urticaria</option>
                            <option value="Angioedema">Angioedema</option>
                            <option value="SJS">Stevens-Johnson Syndrome (SJS)</option>
                            <option value="TEN">Toxic Epidermal Necrolysis (TEN)</option>
                            <option value="SJS-TEN overlap">SJS-TEN overlap</option>
                            <option value="DRESS">DRESS Syndrome</option>
                            <option value="AGEP">AGEP</option>
                            <option value="Fixed Drug Eruption">Fixed Drug Eruption</option>
                            <option value="Anaphylaxis">Anaphylaxis</option>
                            <option value="Other">Other</option>
                        </select>
                    </div>
                    <div class="form-group">
                         <label>Severity:</label>
                         <select id="severityLevel" onchange="syncData()">
                             <option value="-">-</option>
                             <option value="Mild">Mild</option>
                             <option value="Moderate">Moderate</option>
                             <option value="Severe">Severe</option>
                         </select>
                    </div>
                </div>

                <div class="form-group">
                    <label>‡∏£‡∏≤‡∏¢‡∏•‡∏∞‡πÄ‡∏≠‡∏µ‡∏¢‡∏î‡∏≠‡∏≤‡∏Å‡∏≤‡∏£ (Description / Progress):</label>
                    <textarea id="symptomDesc" rows="3" oninput="syncData()"></textarea>
                </div>
                
                <div class="form-group no-print">
                    <label>üì∏ ‡∏£‡∏π‡∏õ‡∏†‡∏≤‡∏û‡∏õ‡∏£‡∏∞‡∏Å‡∏≠‡∏ö:</label>
                    <input type="file" accept="image/*" onchange="previewImage(event)">
                </div>
                <div id="photoPreviewContainer" style="display:none; margin-top:10px; text-align:center;">
                    <img id="photoPreview" src="" style="max-height:150px; border:1px solid #000;">
                </div>
            </section>

            <section class="card no-print">
                <h3>‡∏ú‡∏π‡πâ‡∏õ‡∏£‡∏∞‡πÄ‡∏°‡∏¥‡∏ô</h3>
                <div class="grid-2">
                    <input type="text" id="pharmaName" placeholder="‡∏ä‡∏∑‡πà‡∏≠‡πÄ‡∏†‡∏™‡∏±‡∏ä‡∏Å‡∏£" oninput="syncData()">
                    <input type="text" id="pharmaPlace" placeholder="‡πÅ‡∏ú‡∏ô‡∏Å/‡∏´‡∏ô‡πà‡∏ß‡∏¢‡∏á‡∏≤‡∏ô" oninput="syncData()">
                </div>
            </section>

            <section class="card no-print" style="background:#ffebee; border:1px solid #ef9a9a;">
                <h3 style="color:#c62828;">‡∏ï‡∏±‡∏ß‡∏≠‡∏¢‡πà‡∏≤‡∏á‡∏ö‡∏±‡∏ï‡∏£‡πÅ‡∏û‡πâ‡∏¢‡∏≤</h3>
                <div class="card-preview-wrapper">
                    <div id="allergyCard" class="allergy-card">
                        <div class="ac-header">‚ö† ‡∏ö‡∏±‡∏ï‡∏£‡∏õ‡∏£‡∏∞‡∏à‡∏≥‡∏ï‡∏±‡∏ß‡∏ú‡∏π‡πâ‡πÅ‡∏û‡πâ‡∏¢‡∏≤</div>
                        <div class="ac-body">
                            <div class="ac-row"><span class="ac-label">‡∏ä‡∏∑‡πà‡∏≠:</span> <span id="cardPatientName">-</span></div>
                            <div class="ac-row"><span class="ac-label">‡πÅ‡∏û‡πâ‡∏¢‡∏≤:</span> <span class="ac-value drug-name" id="cardDrugName">-</span></div>
                            <div class="ac-row"><span class="ac-label">‡∏≠‡∏≤‡∏Å‡∏≤‡∏£:</span> <span id="cardReaction">-</span></div>
                            <div class="ac-row"><span class="ac-label">Dx:</span> <span id="cardDiagnosis" style="font-weight:bold;">-</span></div>
                        </div>
                        <div class="ac-footer">
                            <div>‡πÄ‡∏†‡∏™‡∏±‡∏ä‡∏Å‡∏£: <span id="cardEvaluator">-</span></div>
                            <div id="cardDateDisplay"></div>
                        </div>
                    </div>
                </div>
            </section>

            <div class="actions no-print">
                <button type="button" class="btn-print" onclick="printReport()">üñ®Ô∏è ‡∏û‡∏¥‡∏°‡∏û‡πå‡∏£‡∏≤‡∏¢‡∏á‡∏≤‡∏ô (A4 Formal)</button>
                <button type="button" class="btn-print-card" onclick="printCardOnly()">üñ®Ô∏è ‡∏û‡∏¥‡∏°‡∏û‡πå‡∏ö‡∏±‡∏ï‡∏£‡πÅ‡∏û‡πâ‡∏¢‡∏≤ (Card Only)</button>
            </div>

            <div class="print-footer-formal">
                <div class="signature-block">
                    <div class="sign-line">‡∏•‡∏á‡∏ä‡∏∑‡πà‡∏≠ ........................................................... ‡∏ú‡∏π‡πâ‡∏õ‡∏£‡∏∞‡πÄ‡∏°‡∏¥‡∏ô</div>
                    <div class="sign-name">( <span id="printName">........................................</span> )</div>
                    <div class="sign-role">‡πÄ‡∏†‡∏™‡∏±‡∏ä‡∏Å‡∏£ / ‡∏ö‡∏∏‡∏Ñ‡∏•‡∏≤‡∏Å‡∏£‡∏ó‡∏≤‡∏á‡∏Å‡∏≤‡∏£‡πÅ‡∏û‡∏ó‡∏¢‡πå</div>
                    <div class="sign-date">‡∏ß‡∏±‡∏ô‡∏ó‡∏µ‡πà: <span id="printDate">..........................</span></div>
                </div>
            </div>

        </form>
    </div>

    <script src="script.js"></script>
</body>
</html>
